{% load custom_tags %}

{% if not user.is_authenticated %}
    <h2>You are not logged in</h2>
    <h2>Click <a href="{% url 'login' %}">here</a> to log in.</h2>
    <h2>Click <a style="color: red;" href="{% url 'register' %}">here</a> to register</h2>

{% else %}
    <style>
        table {
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        td {
            text-align: center;
        }

        .left-form {
            float: left;
            width: 25%;
        }

        .right-form {
            float: left;
            width: 50%;
        }

        .invalid_values {
            position: absolute;
            top: 38%;
            color: red;
            font-size: 35px;
        }
    </style>
    <div class="left-form">
        <form style="display: inline;" method="get">
            {% csrf_token %}
            {{ form.as_p }}
            <input formnovalidate type="submit" value="Show All" name="All">
            <input type="submit" value="Filter" name="Filter">
        </form>
    </div>

    <div class="right-form">
        <form class="form-calories" method="get">
            {% csrf_token %}
            {{ form_calories.as_p }}
            <input type="submit" value="Add" name="Add">
        </form>
    </div>

    {% if invalid_values %}
        <p class="invalid_values">Min value should be smaller or equal to max value</p>
    {% else %}
        <table>
            <tr>
                <th>Name</th>
                <th>Calories</th>
                <th>Proteins</th>
                <th>Carbohydrates</th>
                <th>Fats</th>
            </tr>

            {% for instance in queryset %}
                <tr>
                    <td>{{ instance.name }}</td>
                    <td>{{ instance.calories }}</td>
                    <td>{{ instance.proteins }}</td>
                    <td>{{ instance.carbohydrates }}</td>
                    <td>{{ instance.fats }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    {% if product_list %}
        <table>
            <tr>
                <th>Calories</th>
                <th>Proteins</th>
                <th>Carbohydrates</th>
                <th>Fats</th>
            </tr>

            <td>{{ total_calories }}</td>
            <td>{{ total_proteins }}</td>
            <td>{{ total_carbohydrates }}</td>
            <td>{{ total_fats }}</td>
        </table>
        <table>
            <tr>
                <th>Index</th>
                <th>Name</th>
                <th>Calories</th>
                <th>Proteins</th>
                <th>Carbohydrates</th>
                <th>Fats</th>
                <th>Quantity</th>
            </tr>

            {% for product, quantity in product_list %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ product.name }}</td>
                    <td>{{ product.calories|quantity_converter:quantity }} </td>
                    <td>{{ product.proteins|quantity_converter:quantity }}</td>
                    <td>{{ product.carbohydrates|quantity_converter:quantity }}</td>
                    <td>{{ product.fats|quantity_converter:quantity }}</td>
                    <td>{{ quantity }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}
{% endif %}